App As appinfo:
    BackEnabled: =true
    Theme: =SharePointTheme

    Host As hostControl.DefaultHostControlVariant:
        OnCancel: =false
        OnEdit: =false
        OnNew: =false
        OnSave: =false
        OnView: =false

    SharePointIntegration As hostControl.SharePointHostControlVariant:
        DataSource: =[@'Quality Problem Status']
        OnCancel: =ResetForm(frmQPS)
        OnEdit: =EditForm(frmQPS)
        OnNew: |-
            =//  新規作成
            NewForm(frmQPS)
        OnSave: |-
            =// フラグ初期化
            Set(gvErrorFlag, false);            //  エラーフラグ
            Set(gvErrMsg, Blank());             //  エラーメッセージ
            Set(gvConfirmFlag, false);          //  確認PopUpの表示・非表示フラグ
            Set(gvErrCount, 0);                 //  エラーカウンター
            Set(gvCloseMail, false);            //  Closeメール送信フラグ
            
            //  入力チェック
            With(
                // 入力データ取得 
                {strSite:ddlSite.Selected.Value,                                //  Site
                 strClaimDescription:rdbClaimDescriptionType.Selected.Value,    //  Claim Description Type
                 strCustomer:ddlCustomer.Selected.Customer,                     //  Customer
                 strMediaProgram:cmbMediaProgram.Selected.Value,                //  Media Program
                 strP1Process:ddlP1RCProcess.Selected.Process,                  //  Process 1 の Process
                 strP1ActualCause:cmbP1RCActualCause.Selected.Value},           //  Process 1 の Actual Cause
                
                If(
                    IsBlank(strSite),
                        Set(gvErrMsg, "Please select a Site！"),
                    IsBlank(strClaimDescription),
                        Set(gvErrMsg, If(!IsBlank(gvErrMsg), Concatenate(gvErrMsg, Char(10))) & "Please select a Claim description！"),
                    IsBlank(strCustomer),
                        Set(gvErrMsg, If(!IsBlank(gvErrMsg), Concatenate(gvErrMsg, Char(10))) & "Please select a Customer！"),
                    IsBlank(strMediaProgram),
                        Set(gvErrMsg, If(!IsBlank(gvErrMsg), Concatenate(gvErrMsg, Char(10))) & "Please select a Media Program！"),
                    IsBlank(strP1Process),
                        Set(gvErrMsg, If(!IsBlank(gvErrMsg), Concatenate(gvErrMsg, Char(10))) & "Please select a Process1 Process！"),
                    IsBlank(strP1ActualCause),
                        Set(gvErrMsg, If(!IsBlank(gvErrMsg), Concatenate(gvErrMsg, Char(10))) & "Please select a Process1 Actual cause！")
                );
                //  エラーメッセージがあれば表示してエラーフラグ=ON
                If(!IsBlank(gvErrMsg),
                    Notify(gvErrMsg, NotificationType.Warning);
                    Set(gvErrorFlag, true)
                )
            );
            
            //  エラーがなければ保存処理
            If(!gvErrorFlag,
                SubmitForm(frmQPS)
            )
        OnView: =ViewForm(frmQPS)
        SelectedHidden: =LookUp([@'Quality Problem Status'], ID = Self.SelectedListItemID)

